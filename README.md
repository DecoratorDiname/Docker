# Docker и Docker Compose

История и описание инструментов для контейнеризации приложений.

## История

- **Docker (2013)**: проект, который сделал контейнеризацию доступной и простой. Основан на Linux-контейнерах и API-слое, совместимом с LXC, и популяризовал понятие «контейнера» для упаковки приложения и его зависимостей.
- Появление удобного слоя для создания образов, репозиториев образов и orchestration-решений позволило разработчикам переносить приложения между окружениями (разработка → тестирование → продакшн) с минимальными изменениями.
- **Docker Hub / Registry**: централизованные реестры для хранения и распространения образов.
- **Docker Compose (2014)**: инструмент, который позволил описывать многоконтейнерные приложения в YAML-файлах и запускать их одной командой. Это упростило локальную разработку и тестирование микросервисной архитектуры.
- Со временем экосистема расширилась: Docker Desktop, Docker Swarm (оркестрация внутри Docker), Kubernetes интеграции и т.д.

## Что такое Docker

- Контейнеризация: упаковка приложения с зависимостями и конфигурацией в образ.
- Образы: читаемые как «снимок» файловой системы и параметров окружения.
- Контейнеры: запущенные экземпляры образов, изолированные друг от друга.
- Изоляция и повторяемость: одинаковые образы работают в любом поддерживаемом окружении.
- Легкость переноса: образ можно передать в реестр и запустить на другой машине с Docker.

Преимущества:
- Быстрое развёртывание и масштабирование.
- Изоляция процессов и зависимостей.
- Ровная среда между локальной разработкой и продакшном.
- Безопасность за счёт ограничений контейнеров.

## Что такое Docker Compose

- Утилита для определения и запуска многоконтейнерных приложений.
- Описывается в одном or нескольких YAML-файлах (обычно docker-compose.yml).
- Позволяет определить сервисы, сети, тома и зависимости между сервисами.
- Команды: docker-compose up, docker-compose down, docker-compose ps, docker-compose logs и пр.

Преимущества:
- Простое управление целыми стеками микросервисов на одной машине.
- Локальная разработка, сборка и запуск с минимальными затратами времени.
- Повторываемость окружения: тот же compose-файл работает на разных машинах.

## Основные концепции

- Образ (Image): читаемая как «пакет» с приложением и окружением.
- Контейнер (Container): запущенная копия образа.
- Dockerfile: инструкции для сборки образа.
- Репозиторий образов (Registry): место хранения образов (Docker Hub, частные реестры).
- Compose-файл: описание многоконтейнерного приложения.
- Сети и тома: маршрутизация и персистентность данных между контейнерами.

## Быстрый пример

Пример простой веб-аппликации на Python с использованием Docker и Docker Compose.

1) Dockerfile
- Создаём образ со своим приложением.

```
# Dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["python", "app.py"]
```

2) requirements.txt
```
flask
```

3) app.py
```
from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "Hello from Docker + Compose!"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)
```

4) docker-compose.yml
```
version: "3.9"
services:
  web:
    build: .
    ports:
      - "5000:5000"
```

5) Запуск
- Сборка и запуск: docker-compose up
- Остановка: docker-compose down

После запуска сайт будет доступен по адресу http://localhost:5000.

## Рекомендации по ведению README

- Включайте разделы: Что это, Примеры использования, Установка, Быстрый старт, Архитектура, Безопасность, Тривиальные проблемы и Решения.
- Указывайте требования к версии Docker и Docker Compose.
- Приводите минимальные примеры для быстрого старта и более сложные примеры для реальных проектов.
- Добавляйте раздел с часто задаваемыми вопросами и ссылками на официальную документацию.

## Установка

- Установка Docker: инструкция на официальном сайте Docker для вашей ОС (Windows, macOS, Linux).
- Установка Docker Compose: обычно включена в Docker Desktop; для отдельных установок — см. документацию.

## Безопасность и наилучшие практики

- Используйте многослойные образы и минимальные базовые образы.
- Не храните секреты в образах; используйте переменные окружения и секретные хранилища.
- Поддерживайте обновления образов и зависимостей.
- Применяйте правила ограничений ресурсов (CPU, память) для контейнеров.
- Разделяйте данные между томами и используйте постоянные хранилища.

____________________________________________

Обзор Dockerfile
----------------
Этот Dockerfile собирает образ для запуска описание приложения. Он включает следующие шаги:
- Базовый образ: FROM …
- Установка зависимостей: RUN …
- Копирование исходников/конфигураций: COPY/ADD …
- Настройка окружения: ENV …
- Настройка рабочего каталога: WORKDIR …
- Команды сборки/установки: RUN …
- Точка входа и запуск: CMD/ENTRYPOINT …
- Открытые порты: EXPOSE …

Исходный Dockerfile
-------------------
Приведите здесь исходный Dockerfile (для удобства быстрого ознакомления):


Docker


# Ваш Dockerfile
FROM ...
# примеры инструкций
ENV ...
WORKDIR ...
COPY . /app
RUN ...
EXPOSE ...
CMD ["..."]


Как собрать образ
------------------
Соберите образ с тегом по умолчанию или укажите нужный тег:

Bash


docker build -t your-image-name:tag .


Если нужно указать файл Dockerfile или контекст сборки:

Bash


docker build --file Dockerfile --build-arg ARG_NAME=value -t your-image-name:tag .


Как запустить контейнер
-----------------------
Простой запуск:

Bash


docker run --rm -p 8080:8080 your-image-name:tag


При необходимости передайте переменные окружения и монтирования:

Bash


docker run --rm -p 8080:8080 \
  -e ENV_VAR=value \
  -v /path/on/host:/path/in/container \
  your-image-name:tag


Использование образа
--------------------
Описание того, как приложение запускается внутри контейнера и что внутри образа:
- Базовый стек: указать базовый образ (например, python:3.11-slim, node:20-alpine и т.д.)
- Основной файл/сервер: упомяните, какой процесс запускается
- Потребности в конфигурации: какиеENV переменные и аргументы можно использовать

Переменные окружения и конфигурация
-----------------------------------
- ENVVAR1: описание и допустимые значения
- ENVVAR2: описание и допустимые значения
- PORT: порт приложения (если отличается от 8080) и пример использования

Тестирование и проверки
-----------------------
После запуска проверьте доступность сервиса:
- URL: http://localhost:8080/health или /ready
- Примеры эндпоинтов, которые гарантируют работоспособность

Структура Dockerfile (ключевые моменты)
---------------------------------------
- Базовый образ: FROM …
- Установка зависимостей: RUN apt-get update && apt-get install -y …
- Копирование файлов: COPY/ADD
- Настройка окружения: ENV
- Рабочий каталог: WORKDIR
- Команда запуска: CMD/ENTRYPOINT
- Права и пользователи: USER (при необходимости)
- Очистка кэша сборки: рекомендуется, если применимо

Производительность и безопасность
-------------------------------
- Минимизация размера образа (многоступенчатая сборка, slim-образы)
- Обновления базового образа и зависимостей
- Не хранить секреты в Dockerfile; используйте переменные окружения или секреты